# 🧠 False Sharing(거짓 공유) 개념 설명 가능 면접 질문 리스트

## ✅ 기본 개념

1. false sharing이란 무엇인가요?

    - 멀티스레딩에서 서로다른 코어 캐시가 값을 갱신했지만, 다른 코어에 전달이 되지 않아 잘못된 정보를 갖고 있는 것을 false sharing이라고 합니다.

2. false sharing은 왜 “거짓(false)”이라고 불리나요?

    - 거짓 정보를 갖고있기 때문입니다.

## ✅ 캐시 / 하드웨어 관점

1. 캐시 라인(cache line)이란 무엇인가요?

    - 캐시가 한꺼번에 가져올 수 있는 영역을 말합니다.

2. false sharing은 캐시 라인과 어떤 관계가 있나요?

    - 캐시 라인을 가져올 때 겹쳐지는 부분을 가져오게 되면 false sharing이 발생할 수 있습니다.

## ✅ 발생 원인

1. 서로 다른 변수를 쓰는데도 성능이 저하되는 이유는 무엇인가요?

    - false sharing으로 캐시라인을 다시 불러와야하기 때문에 성능이 저하되는 경우가 있습니다.

2. 멀티스레드 환경에서 false sharing이 자주 발생하는 이유는 무엇인가요?

    - 여러 스레드가 같은 주소를 같은 시기에 접근하려고 하면 발생하게 됩니다.

## ✅ 해결 방법

1. false sharing을 방지하는 대표적인 방법은 무엇인가요?

    - 캐시라인의 크기만큼은 한 코어가 접근하도록 스레드를 분배합니다.

2. padding이 false sharing 해결에 도움이 되는 이유는 무엇인가요?

    - 한 번 가져가는 캐시라인에 중복되는 영역이 없도록하여 버리는 캐시라인이 없도록 합니다.

3. alignas는 어떤 역할을 하나요?

    - 모르겠습니다.

## ✅ 설계 판단

1. false sharing을 완전히 제거해야 하나요?

<details>
<summary>GPT 1줄 답변</summary>
<div markdown="1">

## ?? 1줄 모범 답변

1. 서로 다른 스레드가 같은 캐시 라인을 공유해 불필요한 동기화가 발생하는 현상입니다.
2. 실제로는 데이터를 공유하지 않기 때문입니다.

3. 캐시가 한 번에 읽고 쓰는 최소 메모리 단위입니다.
4. 같은 캐시 라인에 다른 변수가 함께 들어 있을 때 발생합니다.

5. 캐시 일관성 프로토콜이 캐시 라인을 무효화하기 때문입니다.
6. 스레드가 각자 다른 코어에서 캐시를 사용하기 때문입니다.

7. 데이터 분리, padding 추가, 캐시 라인 정렬입니다.
8. 서로 다른 캐시 라인에 배치되도록 강제하기 때문입니다.
9. 특정 alignment로 메모리 배치를 강제합니다.

10. 비용 대비 효과를 보고 필요한 경우에만 제거합니다.
 “공유하지 않는데 공유된 것처럼 동작하는 캐시 문제”입니다.

</div>
</details>

---

## 📝 GPT 피드백

### ✅ 기본 개념

**질문 1: false sharing이란 무엇인가요?**
- **현재 답변**: "멀티스레딩에서 서로다른 코어 캐시가 값을 갱신했지만, 다른 코어에 전달이 되지 않아 잘못된 정보를 갖고 있는 것을 false sharing이라고 합니다."
- **피드백**:
  - ❌ **오개념**: false sharing의 정의가 완전히 잘못되었습니다
  - ✅ **정확한 답변**: "서로 다른 스레드가 같은 캐시 라인을 공유해 불필요한 동기화가 발생하는 현상입니다"
  - false sharing은 "잘못된 정보를 갖고 있는 것"이 아니라, 서로 다른 스레드가 서로 다른 변수를 사용하지만 같은 캐시 라인에 있어서 캐시 일관성 프로토콜에 의해 불필요한 동기화가 발생하는 현상입니다

**질문 2: false sharing은 왜 "거짓(false)"이라고 불리나요?**
- **현재 답변**: "거짓 정보를 갖고있기 때문입니다."
- **피드백**:
  - ❌ **오개념**: false의 의미를 잘못 이해했습니다
  - ✅ **정확한 답변**: "실제로는 데이터를 공유하지 않기 때문입니다"
  - false sharing에서 "false"는 "거짓 정보"가 아니라, 실제로는 데이터를 공유하지 않는데 캐시 라인을 공유하여 마치 공유하는 것처럼 동작한다는 의미입니다

### ✅ 캐시 / 하드웨어 관점

**질문 2: false sharing은 캐시 라인과 어떤 관계가 있나요?**
- **현재 답변**: "캐시 라인을 가져올 때 겹쳐지는 부분을 가져오게 되면 false sharing이 발생할 수 있습니다."
- **피드백**:
  - ⚠️ **부정확**: "겹쳐지는 부분을 가져오게 되면"이라는 표현이 부정확합니다
  - ✅ **정확한 답변**: "같은 캐시 라인에 다른 변수가 함께 들어 있을 때 발생합니다"
  - false sharing은 캐시 라인이 "겹쳐지는" 것이 아니라, 서로 다른 변수들이 같은 캐시 라인에 배치되어 있을 때 발생합니다. 한 캐시 라인에 여러 변수가 들어있으면, 한 스레드가 한 변수를 수정해도 전체 캐시 라인이 무효화되어 다른 스레드의 캐시도 무효화됩니다

### ✅ 발생 원인

**질문 2: 멀티스레드 환경에서 false sharing이 자주 발생하는 이유는 무엇인가요?**
- **현재 답변**: "여러 스레드가 같은 주소를 같은 시기에 접근하려고 하면 발생하게 됩니다."
- **피드백**:
  - ❌ **오개념**: "같은 주소를 같은 시기에 접근"이 아니라 다른 주소를 접근하지만 같은 캐시 라인에 있을 때 발생합니다
  - ✅ **정확한 답변**: "스레드가 각자 다른 코어에서 캐시를 사용하기 때문입니다"
  - false sharing은 같은 주소를 접근하는 것이 아니라, 서로 다른 변수(다른 주소)를 접근하지만 같은 캐시 라인에 배치되어 있을 때 발생합니다. 각 스레드가 다른 코어에서 실행되면서 각자의 캐시를 사용하므로, 같은 캐시 라인을 공유하면 캐시 일관성 프로토콜에 의해 불필요한 동기화가 발생합니다

### ✅ 해결 방법

**질문 1: false sharing을 방지하는 대표적인 방법은 무엇인가요?**
- **현재 답변**: "캐시라인의 크기만큼은 한 코어가 접근하도록 스레드를 분배합니다."
- **피드백**:
  - ⚠️ **부정확**: "한 코어가 접근하도록 스레드를 분배"라는 설명이 부정확합니다
  - ✅ **정확한 답변**: "데이터 분리, padding 추가, 캐시 라인 정렬입니다"
  - false sharing 방지는 스레드를 분배하는 것이 아니라, 서로 다른 변수들이 서로 다른 캐시 라인에 배치되도록 데이터를 분리하거나 padding을 추가하는 것입니다

**질문 2: padding이 false sharing 해결에 도움이 되는 이유는 무엇인가요?**
- **현재 답변**: "한 번 가져가는 캐시라인에 중복되는 영역이 없도록하여 버리는 캐시라인이 없도록 합니다."
- **피드백**:
  - ⚠️ **부정확**: "중복되는 영역이 없도록", "버리는 캐시라인이 없도록"이라는 표현이 부정확합니다
  - ✅ **정확한 답변**: "서로 다른 멤버가 같은 캐시 라인에 배치되도록 강제하기 때문입니다"
  - padding을 추가하면 서로 다른 변수들이 서로 다른 캐시 라인에 배치되어, 한 변수를 수정해도 다른 변수가 있는 캐시 라인은 영향을 받지 않습니다

**질문 3: alignas는 어떤 역할을 하나요?**
- **현재 답변**: 답변 누락
- **피드백**:
  - ❌ **답변 필요**: 실무에서 중요한 질문입니다
  - ✅ **정확한 답변**: "특정 alignment로 메모리 배치를 강제합니다"
  - alignas는 변수나 구조체의 메모리 정렬을 지정하여, 캐시 라인 경계에 맞춰 배치할 수 있게 해줍니다. 이를 통해 false sharing을 방지할 수 있습니다

### ✅ 설계 판단

**질문 1: false sharing을 완전히 제거해야 하나요?**
- **현재 답변**: 답변 누락
- **피드백**:
  - ❌ **답변 필요**: 실무에서 중요한 질문입니다
  - ✅ **정확한 답변**: "비용 대비 효과를 보고 필요한 경우에만 제거합니다"
  - false sharing을 제거하기 위한 padding이나 데이터 분리는 메모리를 낭비할 수 있으므로, 성능 프로파일링을 통해 실제로 false sharing이 성능 병목인지 확인한 후 필요한 경우에만 제거해야 합니다

### 📊 전체 평가

**강점:**
- 캐시 라인의 기본 개념 이해
- false sharing이 성능 저하를 일으킨다는 점 인지

**개선 필요:**
- ❌ **높음**: false sharing의 기본 개념을 정확히 이해해야 합니다 (같은 캐시 라인을 공유해 불필요한 동기화 발생)
- ❌ **높음**: false sharing에서 "false"의 의미를 정확히 이해해야 합니다 (실제로는 데이터를 공유하지 않음)
- ❌ **높음**: 멀티스레드 환경에서 false sharing 발생 원인을 정확히 이해해야 합니다 (같은 주소가 아니라 같은 캐시 라인)
- ⚠️ **중간**: false sharing과 캐시 라인의 관계를 정확히 이해해야 합니다
- ⚠️ **중간**: false sharing 방지 방법을 정확히 이해해야 합니다 (스레드 분배가 아님)
- ⚠️ **중간**: padding이 false sharing 해결에 도움이 되는 이유를 정확히 이해해야 합니다
- ❌ **중간**: alignas의 역할에 대한 답변이 필요합니다
- ❌ **중간**: false sharing을 완전히 제거해야 하는지에 대한 답변이 필요합니다

**우선순위:**
1. **높음**: false sharing의 기본 개념을 정확히 이해해야 합니다. "잘못된 정보를 갖고 있는 것"이 아니라 "같은 캐시 라인을 공유해 불필요한 동기화가 발생하는 현상"입니다
2. **높음**: false sharing에서 "false"는 실제로는 데이터를 공유하지 않는데 캐시 라인을 공유하여 마치 공유하는 것처럼 동작한다는 의미임을 이해해야 합니다
3. **높음**: 멀티스레드 환경에서 false sharing은 같은 주소를 접근하는 것이 아니라, 서로 다른 변수가 같은 캐시 라인에 배치되어 있을 때 발생함을 이해해야 합니다
4. **중간**: false sharing 방지 방법(데이터 분리, padding, 캐시 라인 정렬)을 정확히 이해해야 합니다
5. **중간**: alignas와 false sharing 제거 필요성에 대한 답변이 필요합니다

**특별 주의사항:**
- false sharing은 면접에서 자주 나오는 주제이며, 기본 개념을 정확히 이해하는 것이 중요합니다
- false sharing은 "같은 주소를 접근"하는 것이 아니라 "같은 캐시 라인에 다른 변수가 있을 때" 발생합니다
- false sharing 방지는 스레드를 분배하는 것이 아니라, 데이터를 분리하거나 padding을 추가하여 서로 다른 캐시 라인에 배치하는 것입니다

